<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>e稲沢 業務報告作成BOT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f8fafc; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
        "@heroicons/react/24/outline": "https://esm.sh/@heroicons/react@2.1.1/24/outline"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
        import React, { useState, useEffect, useMemo, useCallback } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            ClipboardDocumentCheckIcon, TrashIcon, ArrowPathIcon, DocumentTextIcon, 
            BuildingOfficeIcon, InformationCircleIcon, CloudArrowUpIcon, CheckIcon,
            PlusIcon, MinusIcon 
        } from '@heroicons/react/24/outline';

        const INQUIRY_LABELS = { newspaper: '新聞折込', posting: 'ポスティング', flyer: 'チラシ設置', crayon: 'クレヨン', intro: '紹介', hp: 'ホームページ', litalico: 'リタリコ仕事ナビ', previous: '以前問い合わせ者', unknown: '不明' };
        const INITIAL_INQUIRY = { newspaper: 0, posting: 0, flyer: 0, crayon: 0, intro: 0, hp: 0, litalico: 0, previous: 0, unknown: 0 };
        const INITIAL_REPORT = { departmentName: 'e稲沢', reportDate: new Date().toISOString().split('T')[0], contractCount: 0, contractScheduled: 0, intakeScheduled: 0, userCount: 0, intakeCount: 0, newUsers: 0, generalRemarks: '', distributionRemarks: '', inquiryRemarks: '', postingDaily: 0, flyerDaily: 0, inquiryDaily: { ...INITIAL_INQUIRY } };
        const INITIAL_CUMULATIVE = { month: (new Date().getMonth() + 1).toString(), postingTotal: 0, flyerTotal: 0, inquiryTotal: { ...INITIAL_INQUIRY } };

        const UniversalInput = ({ value, onChange, unit, label, theme = 'light' }) => {
            const isIndigo = theme === 'indigo';
            return (
                <div className="space-y-1 w-full">
                    {label && <label className={`text-[10px] font-black uppercase tracking-widest block mb-1 ${isIndigo ? 'text-indigo-800' : 'text-slate-500'}`}>{label}</label>}
                    <div className="flex items-stretch gap-0.5 h-12">
                        <button onClick={() => onChange(Math.max(0, value - 1))} className={`px-4 rounded-l-xl border-2 transition-all ${isIndigo ? 'bg-indigo-100 border-indigo-200 text-indigo-700' : 'bg-slate-100 border-slate-200 text-slate-500'}`}><MinusIcon className="w-5 h-5" /></button>
                        <div className="relative flex-1 min-w-0">
                            <input type="number" value={value} onChange={(e) => onChange(parseInt(e.target.value) || 0)} className={`w-full h-full border-y-2 px-3 text-center font-black outline-none text-xl ${isIndigo ? 'border-indigo-200 bg-white text-indigo-900' : 'border-slate-200 bg-white text-slate-900'}`} />
                            <span className="absolute right-2 top-1/2 -translate-y-1/2 text-[10px] font-black opacity-30 uppercase">{unit}</span>
                        </div>
                        <button onClick={() => onChange(value + 1)} className="px-4 rounded-r-xl border-2 bg-indigo-600 border-indigo-600 text-white"><PlusIcon className="w-5 h-5" /></button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [report, setReport] = useState(() => {
                const savedDept = localStorage.getItem('einazawa_dept');
                const base = JSON.parse(JSON.stringify(INITIAL_REPORT));
                if (savedDept) base.departmentName = savedDept;
                return base;
            });
            const [cumulative, setCumulative] = useState(() => {
                const saved = localStorage.getItem('einazawa_cumulative');
                return saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(INITIAL_CUMULATIVE));
            });
            const [isCopied, setIsCopied] = useState(false);
            const [pasteText, setPasteText] = useState('');
            const [showPasteArea, setShowPasteArea] = useState(false);
            const [highlight, setHighlight] = useState(false);

            useEffect(() => {
                localStorage.setItem('einazawa_cumulative', JSON.stringify(cumulative));
                localStorage.setItem('einazawa_dept', report.departmentName);
            }, [cumulative, report.departmentName]);

            const handleReportChange = (field, value) => setReport(prev => ({ ...prev, [field]: value }));
            const handleInquiryChange = (type, field, value) => {
                if (type === 'daily') setReport(prev => ({ ...prev, inquiryDaily: { ...prev.inquiryDaily, [field]: value } }));
                else setCumulative(prev => ({ ...prev, inquiryTotal: { ...prev.inquiryTotal, [field]: value } }));
            };

            const handleParsePaste = () => {
                try {
                    const newReport = JSON.parse(JSON.stringify(report));
                    const newCumulative = JSON.parse(JSON.stringify(cumulative));
                    const extractVal = (label, text) => {
                        const regex = new RegExp(`${label}[\\s　：:]*([\\d,]+)`, 'm');
                        const match = text.match(regex);
                        return match ? parseInt(match[1].replace(/,/g, ''), 10) : null;
                    };
                    newReport.contractCount = extractVal('【契約人数】', pasteText) ?? newReport.contractCount;
                    newReport.userCount = extractVal('【利用人数】', pasteText) ?? newReport.userCount;
                    setReport(newReport);
                    setHighlight(true);
                    setTimeout(() => { setHighlight(false); setShowPasteArea(false); }, 1500);
                } catch (e) { alert('読み込みに失敗しました。形式を確認してください。'); }
            };

            const generatedReport = useMemo(() => {
                const inquirySection = (data) => Object.keys(INQUIRY_LABELS).map(key => `${INQUIRY_LABELS[key].padEnd(8, '　')} ${data[key] ?? 0}件`).join('\n');
                return `${report.departmentName} (${report.reportDate})\n\n【契約人数】 ${report.contractCount}人\n【利用人数】 ${report.userCount}人\n\n【備考】\n${report.generalRemarks}\n\n【ポスティング数】 ${report.postingDaily}枚\n${cumulative.month}月合計 ${(Number(cumulative.postingTotal)+Number(report.postingDaily))}枚\n\n【問合せ】\n${inquirySection(report.inquiryDaily)}`;
            }, [report, cumulative]);

            const copyToClipboard = () => {
                navigator.clipboard.writeText(generatedReport);
                setIsCopied(true);
                setTimeout(() => setIsCopied(false), 2000);
            };

            return (
                <div className="min-h-screen pb-12 bg-slate-100">
                    <header className="bg-indigo-900 text-white py-6 px-4 shadow-xl mb-8 sticky top-0 z-50">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <h1 className="text-2xl font-black italic">業務報告作成BOT</h1>
                            <button onClick={copyToClipboard} className={`px-8 py-2.5 rounded-xl font-black transition-all ${isCopied ? 'bg-emerald-600' : 'bg-white text-indigo-900'}`}>{isCopied ? 'コピー完了！' : 'コピー'}</button>
                        </div>
                    </header>
                    <main className="max-w-6xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div className="lg:col-span-7 space-y-8">
                            <div className="bg-white p-8 rounded-3xl shadow-md border-2 border-indigo-50 grid grid-cols-2 gap-8">
                                <input type="text" value={report.departmentName} onChange={(e) => handleReportChange('departmentName', e.target.value)} className="w-full border-2 border-slate-200 rounded-xl px-4 py-3" />
                                <input type="date" value={report.reportDate} onChange={(e) => handleReportChange('reportDate', e.target.value)} className="w-full border-2 border-slate-200 rounded-xl px-4 py-3" />
                            </div>
                            <section className="bg-white p-8 rounded-3xl shadow-md space-y-6">
                                <UniversalInput label="契約人数" unit="人" value={report.contractCount} onChange={(v) => handleReportChange('contractCount', v)} />
                                <UniversalInput label="利用人数" unit="人" value={report.userCount} onChange={(v) => handleReportChange('userCount', v)} />
                                <textarea placeholder="備考を入力" value={report.generalRemarks} onChange={(e) => handleReportChange('generalRemarks', e.target.value)} className="w-full border-2 border-slate-300 rounded-2xl p-4 h-24 outline-none focus:border-indigo-600" />
                            </section>
                        </div>
                        <div className="lg:col-span-5">
                            <div className="sticky top-28 bg-slate-900 rounded-[2rem] p-8 h-[600px] shadow-2xl overflow-auto text-emerald-400 font-mono whitespace-pre-wrap">
                                {generatedReport}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
